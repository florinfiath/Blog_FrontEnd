{"ast":null,"code":"\"use strict\";\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  result[\"default\"] = mod;\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar funcs_html_1 = require(\"./funcs-html\");\n\nvar value_types_1 = require(\"./value-types\");\n\nvar obj = __importStar(require(\"./helpers/object\"));\n\nvar arr = __importStar(require(\"./helpers/array\"));\n\nvar OpAttributeSanitizer_1 = require(\"./OpAttributeSanitizer\");\n\nvar DEFAULT_INLINE_FONTS = {\n  serif: 'font-family: Georgia, Times New Roman, serif',\n  monospace: 'font-family: Monaco, Courier New, monospace'\n};\nexports.DEFAULT_INLINE_STYLES = {\n  font: function (value) {\n    return DEFAULT_INLINE_FONTS[value] || 'font-family:' + value;\n  },\n  size: {\n    small: 'font-size: 0.75em',\n    large: 'font-size: 1.5em',\n    huge: 'font-size: 2.5em'\n  },\n  indent: function (value, op) {\n    var indentSize = parseInt(value, 10) * 3;\n    var side = op.attributes['direction'] === 'rtl' ? 'right' : 'left';\n    return 'padding-' + side + ':' + indentSize + 'em';\n  },\n  direction: function (value, op) {\n    if (value === 'rtl') {\n      return 'direction:rtl' + (op.attributes['align'] ? '' : '; text-align:inherit');\n    } else {\n      return undefined;\n    }\n  }\n};\n\nvar OpToHtmlConverter = function () {\n  function OpToHtmlConverter(op, options) {\n    this.op = op;\n    this.options = obj.assign({}, {\n      classPrefix: 'ql',\n      inlineStyles: undefined,\n      encodeHtml: true,\n      listItemTag: 'li',\n      paragraphTag: 'p'\n    }, options);\n  }\n\n  OpToHtmlConverter.prototype.prefixClass = function (className) {\n    if (!this.options.classPrefix) {\n      return className + '';\n    }\n\n    return this.options.classPrefix + '-' + className;\n  };\n\n  OpToHtmlConverter.prototype.getHtml = function () {\n    var parts = this.getHtmlParts();\n    return parts.openingTag + parts.content + parts.closingTag;\n  };\n\n  OpToHtmlConverter.prototype.getHtmlParts = function () {\n    var _this = this;\n\n    if (this.op.isJustNewline() && !this.op.isContainerBlock()) {\n      return {\n        openingTag: '',\n        closingTag: '',\n        content: value_types_1.NewLine\n      };\n    }\n\n    var tags = this.getTags(),\n        attrs = this.getTagAttributes();\n\n    if (!tags.length && attrs.length) {\n      tags.push('span');\n    }\n\n    var beginTags = [],\n        endTags = [];\n    var imgTag = 'img';\n\n    var isImageLink = function (tag) {\n      return tag === imgTag && !!_this.op.attributes.link;\n    };\n\n    for (var _i = 0, tags_1 = tags; _i < tags_1.length; _i++) {\n      var tag = tags_1[_i];\n\n      if (isImageLink(tag)) {\n        beginTags.push(funcs_html_1.makeStartTag('a', this.getLinkAttrs()));\n      }\n\n      beginTags.push(funcs_html_1.makeStartTag(tag, attrs));\n      endTags.push(tag === 'img' ? '' : funcs_html_1.makeEndTag(tag));\n\n      if (isImageLink(tag)) {\n        endTags.push(funcs_html_1.makeEndTag('a'));\n      }\n\n      attrs = [];\n    }\n\n    endTags.reverse();\n    return {\n      openingTag: beginTags.join(''),\n      content: this.getContent(),\n      closingTag: endTags.join('')\n    };\n  };\n\n  OpToHtmlConverter.prototype.getContent = function () {\n    if (this.op.isContainerBlock()) {\n      return '';\n    }\n\n    if (this.op.isMentions()) {\n      return this.op.insert.value;\n    }\n\n    var content = this.op.isFormula() || this.op.isText() ? this.op.insert.value : '';\n    return this.options.encodeHtml && funcs_html_1.encodeHtml(content) || content;\n  };\n\n  OpToHtmlConverter.prototype.getCssClasses = function () {\n    var attrs = this.op.attributes;\n\n    if (this.options.inlineStyles) {\n      return [];\n    }\n\n    var propsArr = ['indent', 'align', 'direction', 'font', 'size'];\n\n    if (this.options.allowBackgroundClasses) {\n      propsArr.push('background');\n    }\n\n    return (this.getCustomCssClasses() || []).concat(propsArr.filter(function (prop) {\n      return !!attrs[prop];\n    }).filter(function (prop) {\n      return prop === 'background' ? OpAttributeSanitizer_1.OpAttributeSanitizer.IsValidColorLiteral(attrs[prop]) : true;\n    }).map(function (prop) {\n      return prop + '-' + attrs[prop];\n    }).concat(this.op.isFormula() ? 'formula' : []).concat(this.op.isVideo() ? 'video' : []).concat(this.op.isImage() ? 'image' : []).map(this.prefixClass.bind(this)));\n  };\n\n  OpToHtmlConverter.prototype.getCssStyles = function () {\n    var _this = this;\n\n    var attrs = this.op.attributes;\n    var propsArr = [['color']];\n\n    if (!!this.options.inlineStyles || !this.options.allowBackgroundClasses) {\n      propsArr.push(['background', 'background-color']);\n    }\n\n    if (this.options.inlineStyles) {\n      propsArr = propsArr.concat([['indent'], ['align', 'text-align'], ['direction'], ['font', 'font-family'], ['size']]);\n    }\n\n    return (this.getCustomCssStyles() || []).concat(propsArr.filter(function (item) {\n      return !!attrs[item[0]];\n    }).map(function (item) {\n      var attribute = item[0];\n      var attrValue = attrs[attribute];\n      var attributeConverter = _this.options.inlineStyles && _this.options.inlineStyles[attribute] || exports.DEFAULT_INLINE_STYLES[attribute];\n\n      if (typeof attributeConverter === 'object') {\n        return attributeConverter[attrValue];\n      } else if (typeof attributeConverter === 'function') {\n        var converterFn = attributeConverter;\n        return converterFn(attrValue, _this.op);\n      } else {\n        return arr.preferSecond(item) + ':' + attrValue;\n      }\n    })).filter(function (item) {\n      return item !== undefined;\n    });\n  };\n\n  OpToHtmlConverter.prototype.getTagAttributes = function () {\n    if (this.op.attributes.code && !this.op.isLink()) {\n      return [];\n    }\n\n    var makeAttr = this.makeAttr.bind(this);\n    var customTagAttributes = this.getCustomTagAttributes();\n    var customAttr = customTagAttributes ? Object.keys(this.getCustomTagAttributes()).map(function (k) {\n      return makeAttr(k, customTagAttributes[k]);\n    }) : [];\n    var classes = this.getCssClasses();\n    var tagAttrs = classes.length ? customAttr.concat([makeAttr('class', classes.join(' '))]) : customAttr;\n\n    if (this.op.isImage()) {\n      this.op.attributes.width && (tagAttrs = tagAttrs.concat(makeAttr('width', this.op.attributes.width)));\n      return tagAttrs.concat(makeAttr('src', this.op.insert.value));\n    }\n\n    if (this.op.isACheckList()) {\n      return tagAttrs.concat(makeAttr('data-checked', this.op.isCheckedList() ? 'true' : 'false'));\n    }\n\n    if (this.op.isFormula()) {\n      return tagAttrs;\n    }\n\n    if (this.op.isVideo()) {\n      return tagAttrs.concat(makeAttr('frameborder', '0'), makeAttr('allowfullscreen', 'true'), makeAttr('src', this.op.insert.value));\n    }\n\n    if (this.op.isMentions()) {\n      var mention = this.op.attributes.mention;\n\n      if (mention.class) {\n        tagAttrs = tagAttrs.concat(makeAttr('class', mention.class));\n      }\n\n      if (mention['end-point'] && mention.slug) {\n        tagAttrs = tagAttrs.concat(makeAttr('href', mention['end-point'] + '/' + mention.slug));\n      } else {\n        tagAttrs = tagAttrs.concat(makeAttr('href', 'about:blank'));\n      }\n\n      if (mention.target) {\n        tagAttrs = tagAttrs.concat(makeAttr('target', mention.target));\n      }\n\n      return tagAttrs;\n    }\n\n    var styles = this.getCssStyles();\n\n    if (styles.length) {\n      tagAttrs.push(makeAttr('style', styles.join(';')));\n    }\n\n    if (this.op.isCodeBlock() && typeof this.op.attributes['code-block'] === 'string') {\n      return tagAttrs.concat(makeAttr('data-language', this.op.attributes['code-block']));\n    }\n\n    if (this.op.isContainerBlock()) {\n      return tagAttrs;\n    }\n\n    if (this.op.isLink()) {\n      tagAttrs = tagAttrs.concat(this.getLinkAttrs());\n    }\n\n    return tagAttrs;\n  };\n\n  OpToHtmlConverter.prototype.makeAttr = function (k, v) {\n    return {\n      key: k,\n      value: v\n    };\n  };\n\n  OpToHtmlConverter.prototype.getLinkAttrs = function () {\n    var tagAttrs = [];\n    var targetForAll = OpAttributeSanitizer_1.OpAttributeSanitizer.isValidTarget(this.options.linkTarget || '') ? this.options.linkTarget : undefined;\n    var relForAll = OpAttributeSanitizer_1.OpAttributeSanitizer.IsValidRel(this.options.linkRel || '') ? this.options.linkRel : undefined;\n    var target = this.op.attributes.target || targetForAll;\n    var rel = this.op.attributes.rel || relForAll;\n    return tagAttrs.concat(this.makeAttr('href', this.op.attributes.link)).concat(target ? this.makeAttr('target', target) : []).concat(rel ? this.makeAttr('rel', rel) : []);\n  };\n\n  OpToHtmlConverter.prototype.getCustomTag = function (format) {\n    if (this.options.customTag && typeof this.options.customTag === 'function') {\n      return this.options.customTag.apply(null, [format, this.op]);\n    }\n  };\n\n  OpToHtmlConverter.prototype.getCustomTagAttributes = function () {\n    if (this.options.customTagAttributes && typeof this.options.customTagAttributes === 'function') {\n      return this.options.customTagAttributes.apply(null, [this.op]);\n    }\n  };\n\n  OpToHtmlConverter.prototype.getCustomCssClasses = function () {\n    if (this.options.customCssClasses && typeof this.options.customCssClasses === 'function') {\n      var res = this.options.customCssClasses.apply(null, [this.op]);\n\n      if (res) {\n        return Array.isArray(res) ? res : [res];\n      }\n    }\n  };\n\n  OpToHtmlConverter.prototype.getCustomCssStyles = function () {\n    if (this.options.customCssStyles && typeof this.options.customCssStyles === 'function') {\n      var res = this.options.customCssStyles.apply(null, [this.op]);\n\n      if (res) {\n        return Array.isArray(res) ? res : [res];\n      }\n    }\n  };\n\n  OpToHtmlConverter.prototype.getTags = function () {\n    var _this = this;\n\n    var attrs = this.op.attributes;\n\n    if (!this.op.isText()) {\n      return [this.op.isVideo() ? 'iframe' : this.op.isImage() ? 'img' : 'span'];\n    }\n\n    var positionTag = this.options.paragraphTag || 'p';\n    var blocks = [['blockquote'], ['code-block', 'pre'], ['list', this.options.listItemTag], ['header'], ['align', positionTag], ['direction', positionTag], ['indent', positionTag]];\n\n    for (var _i = 0, blocks_1 = blocks; _i < blocks_1.length; _i++) {\n      var item = blocks_1[_i];\n      var firstItem = item[0];\n\n      if (attrs[firstItem]) {\n        var customTag = this.getCustomTag(firstItem);\n        return customTag ? [customTag] : firstItem === 'header' ? ['h' + attrs[firstItem]] : [arr.preferSecond(item)];\n      }\n    }\n\n    if (this.op.isCustomTextBlock()) {\n      var customTag = this.getCustomTag('renderAsBlock');\n      return customTag ? [customTag] : [positionTag];\n    }\n\n    var customTagsMap = Object.keys(attrs).reduce(function (res, it) {\n      var customTag = _this.getCustomTag(it);\n\n      if (customTag) {\n        res[it] = customTag;\n      }\n\n      return res;\n    }, {});\n    var inlineTags = [['link', 'a'], ['mentions', 'a'], ['script'], ['bold', 'strong'], ['italic', 'em'], ['strike', 's'], ['underline', 'u'], ['code']];\n    return inlineTags.filter(function (item) {\n      return !!attrs[item[0]];\n    }).concat(Object.keys(customTagsMap).filter(function (t) {\n      return !inlineTags.some(function (it) {\n        return it[0] == t;\n      });\n    }).map(function (t) {\n      return [t, customTagsMap[t]];\n    })).map(function (item) {\n      return customTagsMap[item[0]] ? customTagsMap[item[0]] : item[0] === 'script' ? attrs[item[0]] === value_types_1.ScriptType.Sub ? 'sub' : 'sup' : arr.preferSecond(item);\n    });\n  };\n\n  return OpToHtmlConverter;\n}();\n\nexports.OpToHtmlConverter = OpToHtmlConverter;","map":{"version":3,"sources":["/home/dci/Desktop/Workspace/NoName-People/Backend/BackEndProjects/Blog/Frontend/blog/node_modules/quill-delta-to-html/dist/commonjs/OpToHtmlConverter.js"],"names":["__importStar","mod","__esModule","result","k","Object","hasOwnProperty","call","defineProperty","exports","value","funcs_html_1","require","value_types_1","obj","arr","OpAttributeSanitizer_1","DEFAULT_INLINE_FONTS","serif","monospace","DEFAULT_INLINE_STYLES","font","size","small","large","huge","indent","op","indentSize","parseInt","side","attributes","direction","undefined","OpToHtmlConverter","options","assign","classPrefix","inlineStyles","encodeHtml","listItemTag","paragraphTag","prototype","prefixClass","className","getHtml","parts","getHtmlParts","openingTag","content","closingTag","_this","isJustNewline","isContainerBlock","NewLine","tags","getTags","attrs","getTagAttributes","length","push","beginTags","endTags","imgTag","isImageLink","tag","link","_i","tags_1","makeStartTag","getLinkAttrs","makeEndTag","reverse","join","getContent","isMentions","insert","isFormula","isText","getCssClasses","propsArr","allowBackgroundClasses","getCustomCssClasses","concat","filter","prop","OpAttributeSanitizer","IsValidColorLiteral","map","isVideo","isImage","bind","getCssStyles","getCustomCssStyles","item","attribute","attrValue","attributeConverter","converterFn","preferSecond","code","isLink","makeAttr","customTagAttributes","getCustomTagAttributes","customAttr","keys","classes","tagAttrs","width","isACheckList","isCheckedList","mention","class","slug","target","styles","isCodeBlock","v","key","targetForAll","isValidTarget","linkTarget","relForAll","IsValidRel","linkRel","rel","getCustomTag","format","customTag","apply","customCssClasses","res","Array","isArray","customCssStyles","positionTag","blocks","blocks_1","firstItem","isCustomTextBlock","customTagsMap","reduce","it","inlineTags","t","some","ScriptType","Sub"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar funcs_html_1 = require(\"./funcs-html\");\nvar value_types_1 = require(\"./value-types\");\nvar obj = __importStar(require(\"./helpers/object\"));\nvar arr = __importStar(require(\"./helpers/array\"));\nvar OpAttributeSanitizer_1 = require(\"./OpAttributeSanitizer\");\nvar DEFAULT_INLINE_FONTS = {\n    serif: 'font-family: Georgia, Times New Roman, serif',\n    monospace: 'font-family: Monaco, Courier New, monospace',\n};\nexports.DEFAULT_INLINE_STYLES = {\n    font: function (value) { return DEFAULT_INLINE_FONTS[value] || 'font-family:' + value; },\n    size: {\n        small: 'font-size: 0.75em',\n        large: 'font-size: 1.5em',\n        huge: 'font-size: 2.5em',\n    },\n    indent: function (value, op) {\n        var indentSize = parseInt(value, 10) * 3;\n        var side = op.attributes['direction'] === 'rtl' ? 'right' : 'left';\n        return 'padding-' + side + ':' + indentSize + 'em';\n    },\n    direction: function (value, op) {\n        if (value === 'rtl') {\n            return ('direction:rtl' + (op.attributes['align'] ? '' : '; text-align:inherit'));\n        }\n        else {\n            return undefined;\n        }\n    },\n};\nvar OpToHtmlConverter = (function () {\n    function OpToHtmlConverter(op, options) {\n        this.op = op;\n        this.options = obj.assign({}, {\n            classPrefix: 'ql',\n            inlineStyles: undefined,\n            encodeHtml: true,\n            listItemTag: 'li',\n            paragraphTag: 'p',\n        }, options);\n    }\n    OpToHtmlConverter.prototype.prefixClass = function (className) {\n        if (!this.options.classPrefix) {\n            return className + '';\n        }\n        return this.options.classPrefix + '-' + className;\n    };\n    OpToHtmlConverter.prototype.getHtml = function () {\n        var parts = this.getHtmlParts();\n        return parts.openingTag + parts.content + parts.closingTag;\n    };\n    OpToHtmlConverter.prototype.getHtmlParts = function () {\n        var _this = this;\n        if (this.op.isJustNewline() && !this.op.isContainerBlock()) {\n            return { openingTag: '', closingTag: '', content: value_types_1.NewLine };\n        }\n        var tags = this.getTags(), attrs = this.getTagAttributes();\n        if (!tags.length && attrs.length) {\n            tags.push('span');\n        }\n        var beginTags = [], endTags = [];\n        var imgTag = 'img';\n        var isImageLink = function (tag) {\n            return tag === imgTag && !!_this.op.attributes.link;\n        };\n        for (var _i = 0, tags_1 = tags; _i < tags_1.length; _i++) {\n            var tag = tags_1[_i];\n            if (isImageLink(tag)) {\n                beginTags.push(funcs_html_1.makeStartTag('a', this.getLinkAttrs()));\n            }\n            beginTags.push(funcs_html_1.makeStartTag(tag, attrs));\n            endTags.push(tag === 'img' ? '' : funcs_html_1.makeEndTag(tag));\n            if (isImageLink(tag)) {\n                endTags.push(funcs_html_1.makeEndTag('a'));\n            }\n            attrs = [];\n        }\n        endTags.reverse();\n        return {\n            openingTag: beginTags.join(''),\n            content: this.getContent(),\n            closingTag: endTags.join(''),\n        };\n    };\n    OpToHtmlConverter.prototype.getContent = function () {\n        if (this.op.isContainerBlock()) {\n            return '';\n        }\n        if (this.op.isMentions()) {\n            return this.op.insert.value;\n        }\n        var content = this.op.isFormula() || this.op.isText() ? this.op.insert.value : '';\n        return (this.options.encodeHtml && funcs_html_1.encodeHtml(content)) || content;\n    };\n    OpToHtmlConverter.prototype.getCssClasses = function () {\n        var attrs = this.op.attributes;\n        if (this.options.inlineStyles) {\n            return [];\n        }\n        var propsArr = ['indent', 'align', 'direction', 'font', 'size'];\n        if (this.options.allowBackgroundClasses) {\n            propsArr.push('background');\n        }\n        return (this.getCustomCssClasses() || []).concat(propsArr\n            .filter(function (prop) { return !!attrs[prop]; })\n            .filter(function (prop) {\n            return prop === 'background'\n                ? OpAttributeSanitizer_1.OpAttributeSanitizer.IsValidColorLiteral(attrs[prop])\n                : true;\n        })\n            .map(function (prop) { return prop + '-' + attrs[prop]; })\n            .concat(this.op.isFormula() ? 'formula' : [])\n            .concat(this.op.isVideo() ? 'video' : [])\n            .concat(this.op.isImage() ? 'image' : [])\n            .map(this.prefixClass.bind(this)));\n    };\n    OpToHtmlConverter.prototype.getCssStyles = function () {\n        var _this = this;\n        var attrs = this.op.attributes;\n        var propsArr = [['color']];\n        if (!!this.options.inlineStyles || !this.options.allowBackgroundClasses) {\n            propsArr.push(['background', 'background-color']);\n        }\n        if (this.options.inlineStyles) {\n            propsArr = propsArr.concat([\n                ['indent'],\n                ['align', 'text-align'],\n                ['direction'],\n                ['font', 'font-family'],\n                ['size'],\n            ]);\n        }\n        return (this.getCustomCssStyles() || [])\n            .concat(propsArr\n            .filter(function (item) { return !!attrs[item[0]]; })\n            .map(function (item) {\n            var attribute = item[0];\n            var attrValue = attrs[attribute];\n            var attributeConverter = (_this.options.inlineStyles &&\n                _this.options.inlineStyles[attribute]) ||\n                exports.DEFAULT_INLINE_STYLES[attribute];\n            if (typeof attributeConverter === 'object') {\n                return attributeConverter[attrValue];\n            }\n            else if (typeof attributeConverter === 'function') {\n                var converterFn = attributeConverter;\n                return converterFn(attrValue, _this.op);\n            }\n            else {\n                return arr.preferSecond(item) + ':' + attrValue;\n            }\n        }))\n            .filter(function (item) { return item !== undefined; });\n    };\n    OpToHtmlConverter.prototype.getTagAttributes = function () {\n        if (this.op.attributes.code && !this.op.isLink()) {\n            return [];\n        }\n        var makeAttr = this.makeAttr.bind(this);\n        var customTagAttributes = this.getCustomTagAttributes();\n        var customAttr = customTagAttributes\n            ? Object.keys(this.getCustomTagAttributes()).map(function (k) {\n                return makeAttr(k, customTagAttributes[k]);\n            })\n            : [];\n        var classes = this.getCssClasses();\n        var tagAttrs = classes.length\n            ? customAttr.concat([makeAttr('class', classes.join(' '))])\n            : customAttr;\n        if (this.op.isImage()) {\n            this.op.attributes.width &&\n                (tagAttrs = tagAttrs.concat(makeAttr('width', this.op.attributes.width)));\n            return tagAttrs.concat(makeAttr('src', this.op.insert.value));\n        }\n        if (this.op.isACheckList()) {\n            return tagAttrs.concat(makeAttr('data-checked', this.op.isCheckedList() ? 'true' : 'false'));\n        }\n        if (this.op.isFormula()) {\n            return tagAttrs;\n        }\n        if (this.op.isVideo()) {\n            return tagAttrs.concat(makeAttr('frameborder', '0'), makeAttr('allowfullscreen', 'true'), makeAttr('src', this.op.insert.value));\n        }\n        if (this.op.isMentions()) {\n            var mention = this.op.attributes.mention;\n            if (mention.class) {\n                tagAttrs = tagAttrs.concat(makeAttr('class', mention.class));\n            }\n            if (mention['end-point'] && mention.slug) {\n                tagAttrs = tagAttrs.concat(makeAttr('href', mention['end-point'] + '/' + mention.slug));\n            }\n            else {\n                tagAttrs = tagAttrs.concat(makeAttr('href', 'about:blank'));\n            }\n            if (mention.target) {\n                tagAttrs = tagAttrs.concat(makeAttr('target', mention.target));\n            }\n            return tagAttrs;\n        }\n        var styles = this.getCssStyles();\n        if (styles.length) {\n            tagAttrs.push(makeAttr('style', styles.join(';')));\n        }\n        if (this.op.isCodeBlock() &&\n            typeof this.op.attributes['code-block'] === 'string') {\n            return tagAttrs.concat(makeAttr('data-language', this.op.attributes['code-block']));\n        }\n        if (this.op.isContainerBlock()) {\n            return tagAttrs;\n        }\n        if (this.op.isLink()) {\n            tagAttrs = tagAttrs.concat(this.getLinkAttrs());\n        }\n        return tagAttrs;\n    };\n    OpToHtmlConverter.prototype.makeAttr = function (k, v) {\n        return { key: k, value: v };\n    };\n    OpToHtmlConverter.prototype.getLinkAttrs = function () {\n        var tagAttrs = [];\n        var targetForAll = OpAttributeSanitizer_1.OpAttributeSanitizer.isValidTarget(this.options.linkTarget || '')\n            ? this.options.linkTarget\n            : undefined;\n        var relForAll = OpAttributeSanitizer_1.OpAttributeSanitizer.IsValidRel(this.options.linkRel || '')\n            ? this.options.linkRel\n            : undefined;\n        var target = this.op.attributes.target || targetForAll;\n        var rel = this.op.attributes.rel || relForAll;\n        return tagAttrs\n            .concat(this.makeAttr('href', this.op.attributes.link))\n            .concat(target ? this.makeAttr('target', target) : [])\n            .concat(rel ? this.makeAttr('rel', rel) : []);\n    };\n    OpToHtmlConverter.prototype.getCustomTag = function (format) {\n        if (this.options.customTag &&\n            typeof this.options.customTag === 'function') {\n            return this.options.customTag.apply(null, [format, this.op]);\n        }\n    };\n    OpToHtmlConverter.prototype.getCustomTagAttributes = function () {\n        if (this.options.customTagAttributes &&\n            typeof this.options.customTagAttributes === 'function') {\n            return this.options.customTagAttributes.apply(null, [this.op]);\n        }\n    };\n    OpToHtmlConverter.prototype.getCustomCssClasses = function () {\n        if (this.options.customCssClasses &&\n            typeof this.options.customCssClasses === 'function') {\n            var res = this.options.customCssClasses.apply(null, [this.op]);\n            if (res) {\n                return Array.isArray(res) ? res : [res];\n            }\n        }\n    };\n    OpToHtmlConverter.prototype.getCustomCssStyles = function () {\n        if (this.options.customCssStyles &&\n            typeof this.options.customCssStyles === 'function') {\n            var res = this.options.customCssStyles.apply(null, [this.op]);\n            if (res) {\n                return Array.isArray(res) ? res : [res];\n            }\n        }\n    };\n    OpToHtmlConverter.prototype.getTags = function () {\n        var _this = this;\n        var attrs = this.op.attributes;\n        if (!this.op.isText()) {\n            return [\n                this.op.isVideo() ? 'iframe' : this.op.isImage() ? 'img' : 'span',\n            ];\n        }\n        var positionTag = this.options.paragraphTag || 'p';\n        var blocks = [\n            ['blockquote'],\n            ['code-block', 'pre'],\n            ['list', this.options.listItemTag],\n            ['header'],\n            ['align', positionTag],\n            ['direction', positionTag],\n            ['indent', positionTag],\n        ];\n        for (var _i = 0, blocks_1 = blocks; _i < blocks_1.length; _i++) {\n            var item = blocks_1[_i];\n            var firstItem = item[0];\n            if (attrs[firstItem]) {\n                var customTag = this.getCustomTag(firstItem);\n                return customTag\n                    ? [customTag]\n                    : firstItem === 'header'\n                        ? ['h' + attrs[firstItem]]\n                        : [arr.preferSecond(item)];\n            }\n        }\n        if (this.op.isCustomTextBlock()) {\n            var customTag = this.getCustomTag('renderAsBlock');\n            return customTag ? [customTag] : [positionTag];\n        }\n        var customTagsMap = Object.keys(attrs).reduce(function (res, it) {\n            var customTag = _this.getCustomTag(it);\n            if (customTag) {\n                res[it] = customTag;\n            }\n            return res;\n        }, {});\n        var inlineTags = [\n            ['link', 'a'],\n            ['mentions', 'a'],\n            ['script'],\n            ['bold', 'strong'],\n            ['italic', 'em'],\n            ['strike', 's'],\n            ['underline', 'u'],\n            ['code'],\n        ];\n        return inlineTags.filter(function (item) { return !!attrs[item[0]]; }).concat(Object.keys(customTagsMap)\n            .filter(function (t) { return !inlineTags.some(function (it) { return it[0] == t; }); })\n            .map(function (t) { return [t, customTagsMap[t]]; })).map(function (item) {\n            return customTagsMap[item[0]]\n                ? customTagsMap[item[0]]\n                : item[0] === 'script'\n                    ? attrs[item[0]] === value_types_1.ScriptType.Sub\n                        ? 'sub'\n                        : 'sup'\n                    : arr.preferSecond(item);\n        });\n    };\n    return OpToHtmlConverter;\n}());\nexports.OpToHtmlConverter = OpToHtmlConverter;\n"]},"metadata":{},"sourceType":"script"}